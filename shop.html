<!DOCTYPE HTML>
<html>
    <head>
        <meta charset="utf-8">
        <link rel="stylesheet" href="lookup-style.css">
        <title>UTDesign Tool Lookup</title>
        <script src="libraries/jquery-3.4.1.min.js" type="text/javascript"></script>
        <script>
            var toolData;
            window.onload = function() {
                $.getJSON('tool-data.json', function(data) {
                    toolData = data;
                    // Large Items
                    for(i = 0; i < toolData.largeItems.length; i++){
                        var ul = document.getElementById("toolList");
                        var li = document.createElement("li");
                        var button = document.createElement("button");

                        var finalItemText = toolData.largeItems[i].name; //CHANGE
                        button.innerHTML = finalItemText;

                        var buttonAtt = document.createAttribute("onclick");
                        buttonAtt.value = "clicked(this)";
                        button.setAttributeNode(buttonAtt);
                        li.appendChild(button);
                        ul.appendChild(li);
                    }

                    // Small Items
                    for(i = 0; i < toolData.smallItems.length; i++){
                        var ul = document.getElementById("toolList");
                        var li = document.createElement("li");
                        var button = document.createElement("button");

                        var finalItemText = toolData.smallItems[i].name; //CHANGE
                        button.innerHTML = finalItemText;

                        var buttonAtt = document.createAttribute("onclick");
                        buttonAtt.value = "clicked(this)";
                        button.setAttributeNode(buttonAtt);
                        li.appendChild(button);
                        ul.appendChild(li);
                    }
                });
             

                var c=document.getElementById("shopCanvas");
                var ctx=c.getContext("2d");
                var img=document.getElementById("shopEmpty");  
                ctx.drawImage(img,0,0);  
                var canvas = document.getElementById('shopCanvas');
                var context = canvas.getContext('2d');
            }

            function filter(){
                // Declare variables
                var input, filter, ul, li, a, i, txtValue;
                input = document.getElementById('searchInput');
                filter = input.value.toUpperCase();
                ul = document.getElementById('toolList');
                li = ul.getElementsByTagName('li');

                // Loop through all list items, and hide those who don't match the search query
                for (i = 0; i < li.length; i++) {
                    button = li[i].getElementsByTagName("button")[0];
                    txtValue = button.textContent;
                    if (txtValue.toUpperCase().indexOf(filter) > -1) {
                        li[i].style.display = "";
                    } else {
                        li[i].style.display = "none";
                    }
                }
            }

            function clicked(button){
                //context.clearRect(0, 0, canvas.width, canvas.height);
                var textValue = button.textContent;
                var xPos,yPos;
                var c=document.getElementById("shopCanvas");
                var ctx=c.getContext("2d");
                var img=document.getElementById("shopEmpty");  
                ctx.drawImage(img,0,0);  
                var canvas = document.getElementById('shopCanvas');
                var context = canvas.getContext('2d');

                context.beginPath();
                
                // Input Tool Locations (change xPos and yPos to coordinates of the tool on the diagram)
                for(var i = 0; i < toolData.largeItems.length; i++){
                    if(textValue == toolData.largeItems[i].name){
                        xPos = toolData.largeItems[i].xPos;
                        yPos = toolData.largeItems[i].yPos;
                    }
                }

                for(var i = 0; i < toolData.smallItems.length; i++){
                    if(textValue == toolData.smallItems[i].name){
                        for(var j = 0; j < toolData.locations.length; j++){
                            //alert(textValue + "-" + locations[j].locText + "-" + smallItems[i].location + "-");
                            if(toolData.smallItems[i].location == toolData.locations[j].name){
                                xPos = toolData.locations[j].xPos;
                                yPos = toolData.locations[j].yPos;
                                break;
                            }
                        }
                    }
                }

                context.arc(xPos, yPos, 15, 0, 2 * Math.PI, false);
                context.fillStyle = 'green';
                context.fill();
                context.lineWidth = 5;
                context.strokeStyle = '#003300';
                context.stroke();
            }
        </script>
    </head>

    <body>
        <div class="search">
            <input id="searchInput" class="search-input" type="text" placeholder="Search for a tool..." onkeyup="filter()">
            <br>
            <nav>
                <ul id="toolList" class="toolUL">
                    <!-- this will fil up with some javascript magic -->
                </ul>
            </nav>
        </div>


        <div class="shop-diagram">
            <img src="images/shop_empty.png" class="shop-empty" id="shopEmpty">
            <canvas class= "shop-canvas" id="shopCanvas" width="1240" height="590"></canvas>
        </div>

    </body>
</html>